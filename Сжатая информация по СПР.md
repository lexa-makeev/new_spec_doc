# Логика решения СПР билетов
## Повторяющиеся условия
### Метод отклонения
Данный метод подазумевает, что к примеру Оклад может вытесняться каким-нибудь Невыходом, Больничным, Прогулом или Командировкой.

### Совместительство
Существует 2 варианта развития событий в билетах:
- Каждый сотрудник может работать одновременно только в одном подразделении компании, то есть совместительство не допускается.
- Каждый сотрудник может работать одновременно в нескольких подразделениях компании, то есть совместительство допускается.

В случае с первым вариантом (не допускается) необходимо убрать во всех связанных объектов конфигурации убрать измерения, реквизиты, элементы формы *Подразделение*.

В ином случае, необходимо наоборот указать в измерения, реквизиты, элементы формы *Подразделение*.

### Различные графики работы
При условии возможности работы в по нескольким различным графикам необходимо добавить график работы в Справочник, Регистр сведений, необходимо изменить обработчик, чтобы корректно автоматически заполнялся регистр.

```1С
Процедура ЗаполнитьГрафик(ДатаНачала, ДатаОкончания, График, ВыходныеДни) Экспорт 
    
    Набор = РегистрыСведений.ГрафикиРаботы.СоздатьНаборЗаписей();
	
    Набор.Отбор.График.Установить(График);
	
	ЧислоСекундВСутках = 86400;
	
	Дат = ДатаНачала;
	Пока Дат <= ДатаОкончания Цикл
		Запись = Набор.Добавить();
		Запись.Дата = Дат;
		Запись.График = График;
		Если Найти(ВыходныеДни, Строка(ДеньНедели(Дат))) Тогда
			Запись.Значение = 0;
		Иначе	          
			Запись.Значение = 8;
		КонецЕсли; 
		Дат = Дат + ЧислоСекундВСутках;
	КонецЦикла; 
	Набор.Записать();
    
КонецПроцедуры
```

Основное внимание на изменение кода следует обратить на удаление большиства кода (удаленный код изменяет существующие записи, что не совсем необходимо), добавление графика и добавление иных условий, в зависимости от задачи, а также Отбор по графику.

### Измененение и хранение в базе значение оклада
В задачах может присутствовать следующая формулировка:

**Первоначальное значение оклада может изменяться не чаще, чем один раз в день, но берется на начало расчетного периода. В информационной базе необходимо хранить историю его изменения**

Подразумевается использование регистра сведений *СведенияОСотрудниках*.

### Текущий расчетный период
Фраза в задаче **В одном документе могут быть данные только за текущий расчетный период** означает, что необходимо документ приводить к началу месяца. 
```1С
Движение.ПериодРегистрации = НачалоМесяца(Дата);
```
## Основные принципы
По мимо условий, встречающихся в задаче, следует отметить базовые моменты. В первую очередь необходимо из документа *НачислениеЗарплаты* запретить опер. проведение.
### Основные начисления
Основными начислениями являются те, которые используют период (оклад, больничный, командировка).
#### Регистр сведений *ГрафикРаботы*
Необходимо добавить новое измерение *ГрафикРаботы* тип *СправочникСсылка.ГрафикРабот* (предварительно создать). 
#### План Видов Расчёта
Для этого в *Плане Видов Расчета* необходимо поставить флаг *Использует период действия*. 
#### Регистр расчёта
В регистре расчета также отметить *Период действия*. После флага *Период действия* в регистре необходимо заполнить график, его измерение и ресурс. В регистре, после добавления измерения (к примеру сотрудник) нужно поставить флаг *Базовое*, оно индексирует таблицы при левом соединении.
#### Принцип расчёта Основных начислений
Первым действием записываются движения без результата в регистр. Затем производится расчёт: Запрос из виртуальной таблицы *ДанныеГрафика*, где выбирается *НомерСтроки*, ЕСТЬNULL*ПериодДействия*, ЕСТЬNULL*ЗначениеФактическогоПериода*, *Измерение*. Параметром ВТ является *Регистратор*. Далее по этим данным производится расчёт: Цикл по *Движения.ОсновныеНачисления*, где выборка происходит по командам: 
```
Выборка.Сбросить();
```
и
```
Выборка.НайтиСледующий(Движение.НомерСтроки, "НомерСтроки");
```
В случае с двумя ТЧ использовать:
```
ТЧОсновные = ОсновныеНачисления(Движение.НомерСтроки - 1);
ТЧОсновные.Результат = // Сам расчёт
```
Тернарным оператором необходимо проверить ```ПериодДействия``` на 0 в случае деления на это значение при расчёте.
### Вытеснение
При необходимости включения Невыходов, Командировок и прочих вытесняющих основной оклад видов расчёта, имеющим период нужно выполнить следующее.
- Создать предопределённый вид расчёта в *ОсновныеНачисления* необходимый вытесняющий вид расчёта;
- Зайти в предопределённый вид расчёта *Оклад* и поставить галку на вкладке *Вытесняющие* напротив нужного вида.
### Дополнительные начисления
#### План видов расчёта
Если нужно расчитать премию или подобные дополнительные расчёты, нужно перейти в План и отметить *Использует период действия* на Нет и *Зависит по периоду действия* на основании *ОсновныеНачисления*. В предопределенных на вкладке *Базовые* проставить галку, какой именно план будет являться базой для доп. начислений.
#### Регистры расчёта
В первую очередь нужно вернуться к регистру *ОсновныеНачисления* и поставить галочку *Базовый период*.